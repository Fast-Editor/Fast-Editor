<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://unpkg.com; style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://unpkg.com; img-src 'self' data: https:; font-src 'self' data: https://cdn.jsdelivr.net https://cdnjs.cloudflare.com; connect-src 'self' https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://unpkg.com;">
  <title>Fast Editor</title>
  <link rel="stylesheet" href="../node_modules/@xterm/xterm/css/xterm.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <!-- Markdown libraries loaded on-demand (lazy) for faster startup -->
  <script>
    // Lazy load markdown libraries only when needed
    window.markdownLibsLoaded = false;
    window.markdownLibsPromise = null;

    window.loadMarkdownLibraries = function() {
      if (window.markdownLibsLoaded) {
        return Promise.resolve();
      }

      if (window.markdownLibsPromise) {
        return window.markdownLibsPromise;
      }

      console.log('⚡ Lazy loading markdown libraries...');
      const startTime = performance.now();

      // Disable AMD to prevent conflicts with Monaco's loader
      const originalDefine = window.define;
      window.define = undefined;

      // Note: marked and highlight.js now load in web worker for off-thread parsing
      window.markdownLibsPromise = Promise.all([
        loadScript('https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js'),
        loadScript('https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js'),
        loadScript('https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js')
      ]).then(() => {
        // Restore AMD define after libraries are loaded
        window.define = originalDefine;
        window.markdownLibsLoaded = true;
        const loadTime = performance.now() - startTime;
        console.log(`✅ Markdown libraries loaded in ${loadTime.toFixed(0)}ms`);
      }).catch(err => {
        // Restore AMD define even on error
        window.define = originalDefine;
        throw err;
      });

      return window.markdownLibsPromise;
    };

    function loadScript(src) {
      return new Promise((resolve, reject) => {
        const script = document.createElement('script');
        script.src = src;
        script.async = true;
        script.onload = resolve;
        script.onerror = () => reject(new Error(`Failed to load ${src}`));
        document.head.appendChild(script);
      });
    }
  </script>
  <div id="app">
    <!-- Header / Title Bar -->
    <div id="header">
      <div id="file-info">
        <span id="workspace-name">No Folder Open</span>
        <span class="separator">—</span>
        <span id="file-name">Untitled</span>
        <span id="file-status"></span>
      </div>
      <div id="actions">
        <button id="markdown-preview-btn" class="header-btn" title="Toggle Markdown Preview" style="display: none;">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M14 2H2L1 3V13L2 14H14L15 13V3L14 2ZM14 13H2V3H14V13Z" fill="currentColor"/>
            <path d="M11 10L12 11H4L5 10L6.5 8L8 10L9.5 8.5L11 10Z" fill="currentColor"/>
            <path d="M5 6.5C5 6.77614 4.77614 7 4.5 7C4.22386 7 4 6.77614 4 6.5C4 6.22386 4.22386 6 4.5 6C4.77614 6 5 6.22386 5 6.5Z" fill="currentColor"/>
          </svg>
          Preview
        </button>
        <button id="toggle-terminal" class="header-btn" title="Toggle Terminal (Ctrl+`)">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M13.655 3.56L8.918.75a1.785 1.785 0 0 0-1.836 0L2.345 3.56a1.26 1.26 0 0 0-.655 1.1v6.7a1.26 1.26 0 0 0 .655 1.1l4.737 2.81a1.785 1.785 0 0 0 1.836 0l4.737-2.81a1.26 1.26 0 0 0 .655-1.1v-6.7a1.26 1.26 0 0 0-.655-1.1zM8.5 14.4L3.3 11.4V4.6l5.2 3v6.8zm.5-7.28L3.8 4.1 8 1.65l4.2 2.45L9 7.12z" fill="currentColor"/>
          </svg>
          Terminal
        </button>
        <button id="git-commit-btn" class="header-btn" title="Git Commit (Ctrl+Shift+G)" style="display: none;">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M8 3.25C6.48 3.25 5.25 4.48 5.25 6C5.25 7.52 6.48 8.75 8 8.75C9.52 8.75 10.75 7.52 10.75 6C10.75 4.48 9.52 3.25 8 3.25ZM14.5 5.5H11.17C10.82 3.67 9.28 2.25 7.4 2.05V0.5H6.6V2.05C4.72 2.25 3.18 3.67 2.83 5.5H0.5V6.5H2.83C3.18 8.33 4.72 9.75 6.6 9.95V15.5H7.4V9.95C9.28 9.75 10.82 8.33 11.17 6.5H14.5V5.5Z" fill="currentColor"/>
          </svg>
          Git Commit
        </button>
      </div>
    </div>

    <!-- Main Layout -->
    <div id="main-layout">
      <!-- Activity Bar (Left Icons) -->
      <div id="activity-bar">
        <div class="activity-item active" title="Explorer (Ctrl+Shift+E)">
<svg width="36" height="36" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M17.5 0H8.5L7 1.5V6H2.5L1 7.5V22.5699L2.5 24H14.5699L16 22.5699V18H20.7L22 16.5699V4.5L17.5 0ZM17.5 2.12L19.88 4.5H17.5V2.12ZM14.5 22.5H2.5V7.5H7V16.5699L8.5 18H14.5V22.5ZM20.5 16.5H8.5V1.5H16V6H20.5V16.5Z" fill="#C5C5C5"/>
</svg>
</div>
        <div class="activity-item" title="Search (Ctrl+Shift+F)">
<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M15.25 1.02546e-06C13.6605 -0.000791296 12.1046 0.457574 10.7694 1.32007C9.43422 2.18256 8.37657 3.4124 7.72375 4.8617C7.07094 6.31099 6.85077 7.91801 7.0896 9.4895C7.32843 11.061 8.01604 12.5301 9.06995 13.72L1 22.88L2.12 23.88L10.17 14.76C11.2055 15.5693 12.4192 16.1196 13.7103 16.365C15.0014 16.6104 16.3325 16.5437 17.5927 16.1707C18.8528 15.7976 20.0055 15.1288 20.955 14.2201C21.9044 13.3114 22.623 12.1891 23.0509 10.9465C23.4789 9.70396 23.6038 8.37703 23.4153 7.07642C23.2267 5.77581 22.7302 4.53915 21.967 3.46924C21.2039 2.39933 20.1962 1.52711 19.0278 0.925416C17.8595 0.323719 16.5642 0.00991516 15.25 0.0100108V1.02546e-06ZM15.25 15C13.915 15 12.6099 14.6041 11.4999 13.8624C10.3898 13.1207 9.52469 12.0665 9.01379 10.8331C8.5029 9.59973 8.36919 8.24248 8.62964 6.93311C8.89009 5.62373 9.53305 4.42106 10.4771 3.47705C11.4211 2.53305 12.6237 1.89009 13.9331 1.62964C15.2425 1.36919 16.5997 1.5029 17.8331 2.01379C19.0665 2.52469 20.1207 3.38985 20.8624 4.49988C21.6041 5.60991 22 6.91498 22 8.25C22 10.0402 21.2888 11.7571 20.0229 13.023C18.7571 14.2888 17.0402 15 15.25 15Z" fill="#C5C5C5"/>
</svg>
        </div>
      </div>

      <!-- Sidebar -->
      <div id="sidebar">
        <!-- Explorer View -->
        <div id="explorer-view" class="sidebar-view active">
          <div id="sidebar-header">
            <span>EXPLORER</span>
            <div class="sidebar-actions">
              <button id="new-file-btn" title="New File" class="icon-btn">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M7 3H4V0H3V3H0V4H3V7H4V4H7V3ZM5.5 7H5V6H5.3L6.1 5.1L6.5 5H14V4H8V3H14.5L15 3.5V13.5L14.5 14H1.5L1 13.5V6.5V6V5H2V6V6.5V13H14V7V6H6.7L5.9 6.9L5.5 7Z" fill="#C5C5C5"/>
                </svg>
            </button>
            <button id="new-folder-btn" title="New Folder" class="icon-btn">
              <svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill="currentColor"><path d="M14.5 2H7.71l-.85-.85L6.51 1h-5l-.5.5v11l.5.5h4v-1H2V5h12v3h1V2.5l-.5-.5zm-.51 2H2V2h4.49l.35.15.86.86H14v1z"/><path d="M13.5 7h-1v2.5H10v1h2.5V13h1v-2.5H16v-1h-2.5V7z"/></svg>
            </button>
            <button id="refresh-folder-btn" title="Refresh Explorer" class="icon-btn">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" clip-rule="evenodd" d="M5.56253 2.5158C3.46348 3.45013 2 5.55417 2 8.00002C2 11.3137 4.68629 14 8 14C11.3137 14 14 11.3137 14 8.00002C14 5.32522 12.2497 3.05922 9.83199 2.28485L9.52968 3.23835C11.5429 3.88457 13 5.77213 13 8.00002C13 10.7614 10.7614 13 8 13C5.23858 13 3 10.7614 3 8.00002C3 6.31107 3.83742 4.8177 5.11969 3.91248L5.56253 2.5158Z" fill="#C5C5C5"/>
            <path fill-rule="evenodd" clip-rule="evenodd" d="M5 3H2V2H5.5L6 2.5V6H5V3Z" fill="#C5C5C5"/>
            </svg>
            </button>
            <button id="collapse-all-btn" title="Collapse Folders in Explorer" class="icon-btn">
              <svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill="currentColor"><path d="M9 9H4v1h5V9z"/><path fill-rule="evenodd" clip-rule="evenodd" d="M5 3l1-1h7l1 1v7l-1 1h-2v2l-1 1H3l-1-1V6l1-1h2V3zm1 2h4l1 1v4h2V3H6v2zm4 1H3v7h7V6z"/></svg>
            </button>
          </div>
          </div>
          <div id="file-tree"></div>
        </div>

        <!-- Search View -->
        <div id="search-view" class="sidebar-view">
          <div id="sidebar-header">
            <span>SEARCH</span>
          </div>
          <div class="search-panel">
            <div class="search-input-container">
              <input
                type="text"
                id="search-input"
                class="search-input"
                placeholder="Search"
                autocomplete="off"
                spellcheck="false"
              />
              <button id="toggle-case-sensitive" class="search-option-btn" title="Match Case (Alt+C)">
                Aa
              </button>
              <button id="toggle-whole-word" class="search-option-btn" title="Match Whole Word (Alt+W)">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                  <path d="M0 11H1V13H15V11H16V14H15H1H0V11Z"/>
                  <path d="M6.84 9H9.16L9.47 10H10.74L8.5 3H7.5L5.26 10H6.53L6.84 9ZM7.14 8L8 5.17L8.86 8H7.14Z"/>
                </svg>
              </button>
              <button id="toggle-regex" class="search-option-btn" title="Use Regular Expression (Alt+R)">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                  <path d="M2.5 1H1.5V15H2.5V1Z"/>
                  <path d="M4.5 5L6.5 8L4.5 11H5.9L7.4 8.5L5.9 5H4.5Z"/>
                  <path d="M10.5 5L8.5 8L10.5 11H9.1L7.6 8.5L9.1 5H10.5Z"/>
                  <path d="M13.5 1H14.5V15H13.5V1Z"/>
                </svg>
              </button>
              <button id="search-btn" class="search-action-btn" title="Search (Enter)">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M5.73804 3.31803C4.89412 4.16195 4.42004 5.30657 4.42004 6.50004C4.41962 7.17208 4.57039 7.83558 4.86121 8.44145C5.15202 9.04731 5.57536 9.58001 6.09998 10C6.03038 10.3287 5.99687 10.6641 6 11V11.1701C5.84 11.0601 5.68003 10.95 5.53003 10.83L1.75 14.5L1 13.84L4.80005 10.1501C4.21049 9.48341 3.79142 8.6836 3.57898 7.81938C3.36654 6.95515 3.36703 6.05229 3.58032 5.18827C3.79362 4.32426 4.21337 3.52488 4.80359 2.8588C5.39381 2.19273 6.1368 1.67988 6.96887 1.36418C7.80095 1.04847 8.6973 0.939388 9.58081 1.0463C10.4643 1.15322 11.3086 1.473 12.0414 1.97807C12.7741 2.48313 13.3734 3.15845 13.7877 3.94608C14.202 4.73372 14.419 5.61009 14.42 6.50004C14.4203 6.76784 14.4002 7.03533 14.36 7.30009C14.0728 7.03926 13.7576 6.81114 13.42 6.62003V6.50004C13.42 5.30657 12.9458 4.16195 12.1019 3.31803C11.258 2.47412 10.1135 2.00004 8.92004 2.00004C7.72657 2.00004 6.58195 2.47412 5.73804 3.31803ZM8.77769 7.67407C9.43548 7.23455 10.2089 7 11 7C12.0608 7 13.0782 7.42149 13.8283 8.17163C14.5785 8.92178 15 9.93913 15 11C15 11.7911 14.7654 12.5645 14.3259 13.2223C13.8864 13.8801 13.2616 14.3928 12.5307 14.6956C11.7998 14.9983 10.9955 15.0774 10.2196 14.9231C9.44366 14.7688 8.73102 14.3878 8.17161 13.8284C7.6122 13.269 7.23122 12.5563 7.07688 11.7804C6.92254 11.0045 7.00167 10.2001 7.30442 9.46924C7.60717 8.73833 8.11989 8.1136 8.77769 7.67407ZM8.87864 13.1213C9.44125 13.6839 10.2043 14 11 14C11.623 14.0018 12.2312 13.8095 12.74 13.45L8.55003 9.26001C8.19046 9.76883 7.99818 10.377 7.99998 11C7.99998 11.7956 8.31603 12.5587 8.87864 13.1213ZM9.25999 8.55005L13.4499 12.74C13.8095 12.2312 14.0018 11.623 14 11C14 10.2044 13.6839 9.44127 13.1213 8.87866C12.5587 8.31605 11.7956 8 11 8C10.3769 7.9982 9.7688 8.19048 9.25999 8.55005Z" fill="#C5C5C5"/>
</svg>
              </button>
              <button id="toggle-replace" class="search-action-btn" title="Toggle Replace">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M10.0719 8.024L5.7146 3.66669L6.33332 3.04797L11 7.71464V8.33336L6.33332 13L5.7146 12.3813L10.0719 8.024Z" fill="#C5C5C5"/>
                </svg>
              </button>
            </div>
            <div id="replace-container" class="replace-container hidden">
              <div class="search-input-container">
                <input
                  type="text"
                  id="replace-input"
                  class="search-input"
                  placeholder="Replace"
                  autocomplete="off"
                  spellcheck="false"
                />
                <button id="replace-all-btn" class="search-action-btn" title="Replace All">
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M14.5 2H7.71L6.86 1.15L6.51 1H1.51L1.01 1.5V6.5V13.5L1.51 14H14.51L15.01 13.5V9V2.5L14.5 2ZM13.99 11.49V13H1.99V11.49V7.49V7H6.48L6.83 6.85L7.69 5.99H14V7.49L13.99 11.49ZM13.99 5H7.49L7.14 5.15L6.28 6.01H2V2.01H6.29L7.14 2.86L7.5 3.01H14L13.99 5Z" fill="#C5C5C5"/>
                  </svg>
                </button>
              </div>
            </div>
          </div>
          <div id="search-results" class="search-results">
            <div class="search-empty">Enter search text and press Enter</div>
          </div>
        </div>
      </div>

      <!-- Context Menu -->
      <div id="context-menu" class="context-menu hidden">
        <div class="context-menu-item" data-action="new-file">
          <span>New File</span>
        </div>
        <div class="context-menu-item" data-action="new-folder">
          <span>New Folder</span>
        </div>
        <div class="context-menu-separator"></div>
        <div class="context-menu-item" data-action="rename">
          <span>Rename</span>
        </div>
        <div class="context-menu-item" data-action="delete">
          <span>Delete</span>
        </div>
        <div class="context-menu-separator"></div>
        <div class="context-menu-item" data-action="copy-path">
          <span>Copy Path</span>
        </div>
        <div class="context-menu-item" data-action="copy-relative-path">
          <span>Copy Relative Path</span>
        </div>
        <div class="context-menu-separator"></div>
        <div class="context-menu-item" data-action="reveal-in-finder">
          <span>Reveal in Finder</span>
        </div>
      </div>

      <!-- Quick Open / Go to File -->
      <div id="quick-open-overlay" class="quick-open-overlay hidden">
        <div id="quick-open-modal" class="quick-open-modal">
          <input
            type="text"
            id="quick-open-input"
            class="quick-open-input"
            placeholder="Search files by name..."
            autocomplete="off"
            spellcheck="false"
          />
          <div id="quick-open-results" class="quick-open-results">
            <div class="quick-open-empty">No files found</div>
          </div>
        </div>
      </div>

      <!-- Main Content Area -->
      <div id="main-content">
        <!-- Breadcrumb -->
        <div id="breadcrumb">
          <span id="breadcrumb-path"></span>
        </div>

        <!-- Tab Bar -->
        <div id="tab-bar">
          <div id="tabs"></div>
        </div>

        <!-- Welcome Screen -->
        <div id="welcome-screen">
          <div class="welcome-content">
            <div class="welcome-header">
              <h1>Fast Editor</h1>
              <p class="welcome-subtitle">Blazingly fast code editing</p>
            </div>

            <div class="welcome-sections">
              <div class="welcome-section">
                <h2>Start</h2>
                <div class="welcome-links">
                  <a href="#" class="welcome-link" data-action="new-file">
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path fill-rule="evenodd" clip-rule="evenodd" d="M4 7H3V4H0V3H3V0H4V3H7V4H4V7ZM10.5 1.09998L13.9 4.59998L14 5V13.5L13.5 14H3.5L3 13.5V8H4V13H13V6H9V2H5V1H10.2L10.5 1.09998ZM10 2V5H12.9L10 2Z" fill="#C5C5C5"/>
                  </svg>
                    <span>New File...</span>
                  </a>
                  <a href="#" class="welcome-link" data-action="open-file">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M13.71 4.29L10.71 1.29L10 1H4L3 2V14L4 15H13L14 14V5L13.71 4.29ZM13 14H4V2H9V6H13V14ZM10 5V2L13 5H10Z" fill="#C5C5C5"/>
                </svg>
                    
                    <span>Open File.</span>
                  </a>
                  <a href="#" class="welcome-link" data-action="open-folder">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M7 3H4V0H3V3H0V4H3V7H4V4H7V3ZM5.5 7H5V6H5.3L6.1 5.1L6.5 5H14V4H8V3H14.5L15 3.5V13.5L14.5 14H1.5L1 13.5V6.5V6V5H2V6V6.5V13H14V7V6H6.7L5.9 6.9L5.5 7Z" fill="#C5C5C5"/>
                                </svg>
                    <span>Open Folder...</span>
                  </a>
                </div>
              </div>

              <div class="welcome-section" id="recent-section">
                <h2>Recent</h2>
                <div id="recent-workspaces" class="welcome-links">
                  <p class="welcome-empty">No recent folders</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Editor and Preview Container -->
        <div id="editor-preview-container">
          <!-- Editor Container -->
          <div id="editor-container"></div>

          <!-- Markdown Preview Panel -->
          <div id="markdown-preview-panel" class="markdown-preview-panel">
            <div class="markdown-preview-header">
              <span>PREVIEW</span>
            </div>
            <div id="markdown-preview-content" class="markdown-preview-content">
              <!-- Rendered markdown will appear here -->
            </div>
          </div>
        </div>

        <!-- Terminal Container (initially hidden) -->
        <div id="terminal-container" class="hidden">
          <div id="terminal-header">
            <div class="terminal-tabs" id="terminal-tabs">
              <!-- Terminal tabs will be added here dynamically -->
            </div>
            <div class="terminal-actions">
              <button id="new-terminal-btn" title="New Terminal" class="terminal-action-btn">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M14 7V8H8V14H7V8H1V7H7V1H8V7H14Z" fill="#C5C5C5"/>
                </svg>
              </button>
              <button id="close-terminal-panel" title="Close Terminal Panel" class="terminal-action-btn">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path fill-rule="evenodd" clip-rule="evenodd" d="M7.99998 8.70708L11.6464 12.3535L12.3535 11.6464L8.70708 7.99998L12.3535 4.35353L11.6464 3.64642L7.99998 7.29287L4.35353 3.64642L3.64642 4.35353L7.29287 7.99998L3.64642 11.6464L4.35353 12.3535L7.99998 8.70708Z" fill="#C5C5C5"/>
                </svg>
              </button>
            </div>
          </div>
          <div id="terminal-content">
            <!-- Terminal instances will be added here dynamically -->
          </div>
        </div>
      </div>
    </div>

    <!-- Status Bar -->
    <div id="status-bar">
      <div id="status-left">
        <span id="language-mode">Plain Text</span>
        <span id="encoding">UTF-8</span>
        <span id="line-ending">LF</span>
        <span id="saving-indicator" style="display: none;">Saving...</span>
      </div>
      <div id="status-right">
        <span id="ai-settings-btn" class="clickable" title="AI Settings">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" style="vertical-align: middle; margin-right: 4px;">
            <path d="M8 10.5C9.38071 10.5 10.5 9.38071 10.5 8C10.5 6.61929 9.38071 5.5 8 5.5C6.61929 5.5 5.5 6.61929 5.5 8C5.5 9.38071 6.61929 10.5 8 10.5Z" stroke="currentColor" stroke-width="1" fill="none"/>
            <path d="M14 8.67V7.33L12.67 6.95C12.57 6.62 12.43 6.3 12.26 6L12.95 4.67L11.98 3.7L10.67 4.4C10.37 4.23 10.05 4.09 9.72 3.99L9.33 2.67H7.67L7.28 3.99C6.95 4.09 6.63 4.23 6.33 4.4L5.02 3.7L4.05 4.67L4.74 6C4.57 6.3 4.43 6.62 4.33 6.95L3 7.33V8.67L4.33 9.05C4.43 9.38 4.57 9.7 4.74 10L4.05 11.33L5.02 12.3L6.33 11.6C6.63 11.77 6.95 11.91 7.28 12.01L7.67 13.33H9.33L9.72 12.01C10.05 11.91 10.37 11.77 10.67 11.6L11.98 12.3L12.95 11.33L12.26 10C12.43 9.7 12.57 9.38 12.67 9.05L14 8.67Z" stroke="currentColor" stroke-width="1" fill="none"/>
          </svg>
          AI
        </span>
        <span id="auto-save-indicator" class="clickable" onclick="toggleAutoSave()" title="Click to toggle auto-save">Auto Save: ON</span>
        <span id="cursor-position">Ln 1, Col 1</span>
        <span id="spaces">Spaces: 2</span>
      </div>
    </div>

    <!-- AI Settings Modal -->
    <div id="ai-settings-modal" class="modal-overlay hidden">
      <div class="modal-content ai-settings-panel">
        <div class="modal-header">
          <h2>AI Completions Settings</h2>
          <button id="ai-settings-close" class="modal-close" title="Close">×</button>
        </div>

        <div class="modal-body">
          <!-- Enable/Disable -->
          <div class="settings-group">
            <label class="checkbox-label">
              <input type="checkbox" id="ai-enabled">
              <span>Enable AI-Powered Completions</span>
            </label>
            <p class="settings-hint">Get intelligent code suggestions powered by AI</p>
          </div>

          <!-- Provider Selection -->
          <div class="settings-group">
            <label for="ai-provider">Provider</label>
            <select id="ai-provider" class="settings-input">
              <option value="azure">Azure OpenAI (Recommended for Enterprise)</option>
              <option value="openai">OpenAI (ChatGPT)</option>
              <option value="anthropic">Anthropic (Claude)</option>
              <option value="ollama">Ollama (Local - Free)</option>
              <option value="local">Custom Local Endpoint</option>
            </select>
          </div>

          <!-- API Key -->
          <div class="settings-group">
            <label for="ai-api-key">API Key</label>
            <input type="password" id="ai-api-key" class="settings-input" placeholder="Your API key">
            <p class="settings-hint">Required for cloud providers (Azure, OpenAI, Anthropic)</p>
          </div>

          <!-- Endpoint -->
          <div class="settings-group">
            <label for="ai-endpoint">Endpoint URL</label>
            <input type="text" id="ai-endpoint" class="settings-input" placeholder="https://your-resource.openai.azure.com">
            <p class="settings-hint">Required for Azure and local providers</p>
          </div>

          <!-- Model -->
          <div class="settings-group">
            <label for="ai-model">Model</label>
            <input type="text" id="ai-model" class="settings-input" placeholder="gpt-4">
            <p class="settings-hint">Model name or ID</p>
          </div>

          <!-- Azure Specific Fields -->
          <div id="azure-specific-fields" style="display: none;">
            <div class="settings-group">
              <label for="ai-azure-deployment">Azure Deployment Name</label>
              <input type="text" id="ai-azure-deployment" class="settings-input" placeholder="gpt-4">
              <p class="settings-hint">Your deployment name in Azure Portal</p>
            </div>

            <div class="settings-group">
              <label for="ai-azure-version">Azure API Version</label>
              <input type="text" id="ai-azure-version" class="settings-input" value="2024-02-15-preview">
              <p class="settings-hint">Azure OpenAI API version</p>
            </div>
          </div>

          <!-- Advanced Settings (Collapsible) -->
          <details class="settings-details">
            <summary>Advanced Settings</summary>

            <div class="settings-group">
              <label for="ai-max-tokens">Max Tokens</label>
              <input type="number" id="ai-max-tokens" class="settings-input" value="100" min="10" max="500">
              <p class="settings-hint">Maximum tokens in completion (10-500)</p>
            </div>

            <div class="settings-group">
              <label for="ai-temperature">Temperature</label>
              <input type="number" id="ai-temperature" class="settings-input" value="0.2" min="0" max="1" step="0.1">
              <p class="settings-hint">Creativity level (0.0-1.0, lower = more deterministic)</p>
            </div>

            <div class="settings-group">
              <label for="ai-debounce">Debounce Delay (ms)</label>
              <input type="number" id="ai-debounce" class="settings-input" value="500" min="0" max="5000" step="100">
              <p class="settings-hint">Wait time before sending request (milliseconds)</p>
            </div>

            <div class="settings-group">
              <label for="ai-context-lines">Context Lines</label>
              <input type="number" id="ai-context-lines" class="settings-input" value="50" min="10" max="200">
              <p class="settings-hint">Lines of code to send as context</p>
            </div>

            <div class="settings-group">
              <label class="checkbox-label">
                <input type="checkbox" id="ai-cache-enabled" checked>
                <span>Enable Caching</span>
              </label>
              <p class="settings-hint">Cache completions to reduce API calls</p>
            </div>

            <div class="settings-group">
              <label for="ai-cache-duration">Cache Duration (minutes)</label>
              <input type="number" id="ai-cache-duration" class="settings-input" value="5" min="1" max="60">
              <p class="settings-hint">How long to cache completions</p>
            </div>
          </details>
        </div>

        <div class="modal-footer">
          <button id="ai-settings-cancel" class="btn btn-secondary">Cancel</button>
          <button id="ai-settings-save" class="btn btn-primary">Save Settings</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Git Branch Switcher Modal -->
  <div id="git-branch-modal" class="hidden">
    <div class="git-branch-dialog">
      <div class="git-branch-header">
        <h3>Switch Branch</h3>
        <button id="git-branch-close" class="modal-close-btn">×</button>
      </div>

      <div class="git-branch-body">
        <!-- Create new branch -->
        <div class="git-branch-create">
          <input type="text" id="git-new-branch-name" class="git-branch-input" placeholder="Create new branch..." />
          <button id="git-create-branch-btn" class="git-branch-create-btn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
              <path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Create
          </button>
        </div>

        <!-- Branch list -->
        <div class="git-branch-section">
          <h4>BRANCHES</h4>
          <div class="git-branch-list" id="git-branch-list">
            <div class="git-branch-loading">Loading branches...</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Git Commit Modal -->
  <div id="git-commit-modal" class="hidden">
    <div class="git-commit-dialog">
      <!-- Header -->
      <div class="git-modal-header">
        <button id="git-commit-back" class="git-back-btn">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
        <h2>Commit Changes</h2>
        <button class="git-branch-badge" id="git-current-branch" title="Click to switch branch">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
            <path d="M11.75 2.5a1.25 1.25 0 1 0 0 2.5 1.25 1.25 0 0 0 0-2.5zm-2.5 1.25a2.5 2.5 0 0 1 4.607 1.332c.355.028.672.126.945.288A2.478 2.478 0 0 1 16 7.5c0 1.126-.694 2.191-1.83 2.54-.424.13-.89.16-1.337.06l-.281-.063c-.094.753-.421 1.432-.905 1.96A3.828 3.828 0 0 1 9 13c-.598 0-1.163-.144-1.647-.397A3.828 3.828 0 0 1 6 11c0-.598.144-1.163.397-1.647A3.828 3.828 0 0 1 9 8c.598 0 1.163.144 1.647.397A2.478 2.478 0 0 0 11 10.5c0 .126.01.251.03.373l.281.063c.291.065.61.046.897-.042.768-.236 1.292-.973 1.292-1.894 0-.753-.461-1.394-1.117-1.661a.997.997 0 0 0-.593-.061l-.248.062a.5.5 0 0 1-.604-.373 1.5 1.5 0 1 0-2.876.586.5.5 0 0 1-.166.635l-.175.14a2.5 2.5 0 1 0 .76 3.457.5.5 0 0 1 .82.573A3.5 3.5 0 1 1 5 9c0-.818.393-1.544 1-2v5a2 2 0 1 0 4 0v-3a1 1 0 0 1 1.647-.765z"/>
          </svg>
          <span id="git-branch-name">main</span>
        </button>
      </div>

      <!-- Tabs -->
      <div class="git-tabs">
        <button class="git-tab" id="git-tab-staged" data-tab="staged">
          <span>Staged</span>
          <span class="git-tab-count" id="git-staged-count">(0)</span>
        </button>
        <button class="git-tab active" id="git-tab-unstaged" data-tab="unstaged">
          <span>Unstaged</span>
          <span class="git-tab-count" id="git-unstaged-count">(0)</span>
        </button>
      </div>

      <div class="git-modal-body">
        <!-- File List Section -->
        <div class="git-files-section">
          <div class="git-section-header">
            <h3>CHANGED FILES</h3>
            <button id="git-select-all" class="git-text-btn">Select All</button>
          </div>

          <div class="git-files-list" id="git-files-list">
            <div class="git-empty-state">Loading files...</div>
          </div>
        </div>

        <!-- Commit Message Section -->
        <div class="git-message-section">
          <h3>COMMIT MESSAGE</h3>
          <div class="git-message-inputs">
            <input type="text" id="git-commit-summary" class="git-summary-input" placeholder="Summary (required)" />
            <textarea id="git-commit-description" class="git-description-input" placeholder="Description (optional)" rows="3"></textarea>
          </div>
        </div>

        <!-- Push Toggle -->
        <div class="git-push-toggle">
          <div class="git-push-info">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
              <path d="M12 2L12 16M12 2L8 6M12 2L16 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M5 22H19" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <circle cx="12" cy="19" r="1.5" fill="currentColor"/>
            </svg>
            <div>
              <div class="git-push-title">Push immediately</div>
              <div class="git-push-subtitle" id="git-push-destination">Push to origin/main</div>
            </div>
          </div>
          <label class="git-toggle-switch">
            <input type="checkbox" id="git-auto-push">
            <span class="git-toggle-slider"></span>
          </label>
        </div>
      </div>

      <!-- Bottom Action -->
      <div class="git-commit-actions">
        <button id="git-commit-submit" class="git-primary-btn" disabled>
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
            <path d="M20 6L9 17L4 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span id="git-commit-btn-text">Commit 0 Files</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Xterm.js - Load BEFORE Monaco to avoid AMD conflicts -->
  <script>
    // Disable AMD for xterm to avoid conflicts with Monaco loader
    window.define_backup = window.define;
    window.define = undefined;
  </script>
  <script src="../node_modules/@xterm/xterm/lib/xterm.js"></script>
  <script src="../node_modules/@xterm/addon-fit/lib/addon-fit.js"></script>
  <script src="../node_modules/@xterm/addon-web-links/lib/addon-web-links.js"></script>
  <script>
    // Restore AMD define for Monaco
    window.define = window.define_backup;
    window.define_backup = undefined;
  </script>

  <!-- Monaco Loader -->
  <script src="../node_modules/monaco-editor/min/vs/loader.js"></script>

  <!-- App Scripts -->
  <!-- Critical: Load immediately for core functionality -->
  <script src="tabs.js"></script>
  <script src="sidebar.js"></script>
  <script src="editor.js"></script>
  <script src="intellisense.js"></script>
  <script src="type-definitions.js"></script>
  <script src="ai-completions.js"></script>
  <script src="ai-settings.js"></script>
  <script src="diff-editor.js"></script>
  <script src="git.js"></script>
  <script src="lsp.js"></script>
  <script src="lsp-monaco.js"></script>
  <script src="activity-bar.js"></script>
  <script src="terminal.js"></script>
  <script src="markdown.js"></script>
  <script src="app.js"></script>

  <!-- Non-critical: Defer for faster initial load -->
  <script src="welcome.js" defer></script>
  <script src="quick-open.js" defer></script>
  <script src="search.js" defer></script>
</body>
</html>
